<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Locate me!</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>

    <style>
      #map {
        height: 80vh;
      }
    </style>
  </head>
  <body>
    <h1>Locate me!</h1>
    <div id="map"></div>
    <script>
      const getSessionId = () => {
        const queryString = window.location.search
        const urlParams = new URLSearchParams(queryString)
        return urlParams.get('session')
      }

      const sessionId = getSessionId()

      var map = L.map('map')

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
        maxZoom: 18,
      }).addTo(map)

      var circle = L.circleMarker([0, 0]).addTo(map)

      if (sessionId) {
        const updateMap = () => {
          fetch(`api/session/${sessionId}`)
            .then(response => response.json())
            .then(data => {
              // Update the map
              console.log('Update map')
              map.setView([data.latitude, data.longitude], 13)
              circle.setLatLng([data.latitude, data.longitude])
              circle.setRadius(100)
            })
        }

        // Initialize map
        updateMap()

        // Refresh map every X ms
        setInterval(updateMap, 5000)
      }
    </script>
  </body>
</html>
